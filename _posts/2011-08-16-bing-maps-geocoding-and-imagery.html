---
layout: post
title: "Bing Maps - Geocoding and Imagery"
date: 2011-08-17 05:06:00
tags: gis
comments: true
---
<p>
Since I did a lot of GIS related stuff recently for work, I decided I'd have some fun with the Bing Maps API. I've been using Bing to display maps as a base for multiple layers of data in combination with MapGuide OS and needed to convert addresses to geocodes (coordinates). Afterwards I decided to play with it some more and I created a little app in C# that makes more use of Bing Maps.
</p>
<p>
If you want to <strong>get started with the Bing API</strong>, you'll first need to <strong>get a key</strong>. More info on that can be found <a title="Bing Maps Key" href="http://msdn.microsoft.com/en-us/library/ff428642.aspx">on MSDN</a>.
</p>
<p>
Alright, now you got your key, let's get started!
</p>
<p>
First thing you need to do to use the Bing Maps service, is <strong>adding a service reference</strong>. We'll start out with some geocoding, so we need the geocode service. The addresses of the available services can be found <a title="Bing Maps Services" href="http://msdn.microsoft.com/en-us/library/cc966738.aspx">here</a>.
</p>

<div class="imagecaption" style="width: 500px;">
 <a href="http://kevinpelgrims.com/blog/get/images/2011/08/bingapi_servicereference.png"><img title="Bing Maps Service" src="http://kevinpelgrims.com/blog/get/images/2011/08/bingapi_servicereference.png" alt="" width="500" height="404" /></a>
 <br /><span class="caption">Click &quot;Add Service Reference...&quot; to open the service reference dialog</span>
</div>

<p>
The we can use the following code to "<strong>geocode</strong>" an address (get the coordinates):
</p>

<pre class="prettyprint">
private String Geocode(string address)
{
    GeocodeRequest geocodeRequest = new GeocodeRequest();

    // Set credentials using a Bing Maps key
    geocodeRequest.Credentials = new GeocodeService.Credentials();
    geocodeRequest.Credentials.ApplicationId = key;

    // Set the address
    geocodeRequest.Query = address;

    // Make the geocode request
    GeocodeServiceClient geocodeService = new GeocodeServiceClient(&quot;BasicHttpBinding_IGeocodeService&quot;);
    GeocodeResponse geocodeResponse = geocodeService.Geocode(geocodeRequest);

    return GetGeocodeResults(geocodeResponse);
}
</pre>

<p>
GetGeocodeResults is just a function that I made to print out the response on the screen. As seen here:
</p>
<div class="imagecaption" style="width: 500px;">
 <a href="http://kevinpelgrims.com/blog/get/images/2011/08/bingapi_geocode.png"><img title="Bing Maps Geocode" src="http://kevinpelgrims.com/blog/get/images/2011/08/bingapi_geocode.png" alt="" width="500" height="333" /></a>
 <br /><span class="caption">Get the coordinates for an address</span>
</div>

<p>
(There are some extra options available. You could, for example, tell the service to only return "high confidence" results. But I'm not going to talk about that here.)
</p>

<p>
Because getting the coordinates was so easy, I decided to also implement <strong>reverse geocoding</strong>. Which is (as you would expect) converting coordinates to an address.
</p>

<pre class="prettyprint">
private String ReverseGeocode(double latitude, double longitude)
{
    ReverseGeocodeRequest reverseGeocodeRequest = new ReverseGeocodeRequest();

    // Set credentials using a Bing Maps key
    reverseGeocodeRequest.Credentials = new GeocodeService.Credentials();
    reverseGeocodeRequest.Credentials.ApplicationId = key;

    // Set the coordinates
    reverseGeocodeRequest.Location = new BingMapsSoap.GeocodeService.GeocodeLocation() { Latitude = latitude, Longitude = longitude };

    // Make the reverse geocode request
    GeocodeServiceClient geocodeService = new GeocodeServiceClient(&quot;BasicHttpBinding_IGeocodeService&quot;);
    GeocodeResponse geocodeResponse = geocodeService.ReverseGeocode(reverseGeocodeRequest);

    return GetGeocodeResults(geocodeResponse);
}
</pre>

<div class="imagecaption" style="width: 500px;">
 <a href="http://kevinpelgrims.com/blog/get/images/2011/08/bingapi_reversegeocode.png"><img title="Bing Maps Reverse Geocode" src="http://kevinpelgrims.com/blog/get/images/2011/08/bingapi_reversegeocode.png" alt="" width="500" height="333" /></a>
 <br /><span class="caption">Converting coordinates to addresses is easy!</span>
</div>

<p>
After getting this far in about 15 minutes of figuring it out and coding, I couldn't stop there! I decided to add some <strong>basic imagery</strong> for the address/coordinates that are converted. For imagery you need to <strong>add a reference</strong> to <strong>the imagery service</strong> first. Writing code for this is also pretty easy, as there are plenty of examples on MSDN that can be useful. It seems Microsoft really put some effort into Â documenting this right :-)
</p>

<pre class="prettyprint">
private void GetImagery(double latitude, double longitude)
{
    MapUriRequest mapUriRequest = new MapUriRequest();

    // Set credentials using Bing Maps key
    mapUriRequest.Credentials = new ImageryService.Credentials();
    mapUriRequest.Credentials.ApplicationId = key;

    // Set the location of the image
    mapUriRequest.Center = new ImageryService.Location();
    mapUriRequest.Center.Latitude = latitude;
    mapUriRequest.Center.Longitude = longitude;

    // Set map style and zoom level
    MapUriOptions mapUriOptions = new MapUriOptions();
    mapUriOptions.Style = MapStyle.AerialWithLabels;
    mapUriOptions.ZoomLevel = 17;

    // Set size of the image to match the size of the image control
    mapUriOptions.ImageSize = new ImageryService.SizeOfint();
    mapUriOptions.ImageSize.Height = 160;
    mapUriOptions.ImageSize.Width = 160;

    mapUriRequest.Options = mapUriOptions;

    ImageryServiceClient imageryService = new ImageryServiceClient(&quot;BasicHttpBinding_IImageryService&quot;);
    MapUriResponse mapUriResponse = imageryService.GetMapUri(mapUriRequest);
    BitmapImage bmpImg = new BitmapImage(new Uri(mapUriResponse.Uri));
    bingImage.Source = bmpImg;
}
</pre>

<p>
That code gives us this result:
</p>

<a href="http://kevinpelgrims.com/blog/get/images/2011/08/bingapi_imagery.png"><img title="Bing Maps Imagery" src="http://kevinpelgrims.com/blog/get/images/2011/08/bingapi_imagery.png" alt="" width="500" height="333" /></a>

<p>
Looks pretty good for a small app that took almost no time to make. The Bing Maps API is pretty straight-forward to work with and MSDN has some good samples to get started. So if you're interested in working with Bing Maps, be sure to check out <a title="Bing Maps on MSDN" href="http://msdn.microsoft.com/en-us/library/dd877180.aspx">the documentation</a>.
</p>
<p>
Now go and have fun with this!
</p>
