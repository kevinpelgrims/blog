---
layout: post
title: "PowerShell 2.0 - Background Jobs"
date: 2010-04-27 19:19:07
tags: powershell
comments: true
---
<p>
I already told you about a few <a href="http://kevinpelgrims.com/blog/2010/02/17/powershell-2-what-is-it-and-whats-new/" target="_self">cool new features</a> in PowerShell 2.0, now it's time to play with them. I've divided one large article into four small ones, to make it a bit more readable. We'll start with <strong>background jobs</strong>, <strong>transactions</strong> and <strong>modules</strong> and end with <strong>remoting</strong>. These will become very useful for the PowerShell master.
</p>

<h2>Background jobs</h2>

<p>What do these things do again? Background jobs are commands that run asynchronously. When you run a background job, the command prompt returns immediately, even if the command is still running.
</p>
<p>
Background jobs can be really useful to run complex commands on the background, while continuing some other work. Let's see how this works and start off with the commands, it's actually pretty easy.
</p>

<p>The basic (and most important) commands are <strong>Start-Job</strong>, <strong>Get-Job</strong> and <strong>Stop-Job</strong>. A small demonstration:
<br />
<a href="http://kevinpelgrims.com/blog/get/images/2010/04/backgroundjobs1.png"><img  title="PowerShell_backgroundjobs1" src="http://kevinpelgrims.com/blog/get/images/2010/04/backgroundjobs1.png" alt="" width="510" height="127" /></a>
<br />
As you can see, Start-Job starts a background job (surprise, surprise!) and shows us some info of the newly created job.
</p>

<p>
In the small script above I created a command that would normally pause the execution of it for 30 seconds. Now, because of the use of a background process we can immediately continue our work, while the first piece of script keeps running in the background.
<br />
<a href="http://kevinpelgrims.com/blog/get/images/2010/04/backgroundjobs2.png"><img title="PowerShell_backgroundjobs" src="http://kevinpelgrims.com/blog/get/images/2010/04/backgroundjobs2.png" alt="" width="510" height="140" /></a>
<br />
Get-Job gets a list of running or completed jobs in the current session, as you probably expected. Using this command we also get a lot of useful information, like state and command of the job.
</p>

<p>
Using the Id we can find with the Get-Job command, we can also stop the execution a running job with <strong>Stop-Job</strong>.
</p>

<pre class="prettyprint">
PS D:\ProjectsPS> Stop-Job 3
</pre>

<p>
If we want to get rid of the job completely, we simply remove it:
</p>

<pre class="prettyprint">
PS D:\ProjectsPS> Remove-Job 3
</pre>

<p>
What if you want to run a command that returns data? Use <strong>Receive-Job</strong>!
</p>

<pre class="prettyprint">
$job = Start-Job -scriptblock {Get-Process}
Receive-Job -job $job
</pre>

<p>
The Receive-Job command will output the data from the scriptblock used in Start-Job (in this case, a list of processes on the computer).
</p>
<p>
These are pretty basic uses of background jobs, but it demonstrates how powerful this can be when creating large scripts that have to execute fast. For more information on this topic, use the PowerShell help, it's all there! Tip: Get-Help about_Jobs
</p>
<p>
Do try this at home!
</p>

<h2>Recources</h2>

A list of resources on the discussed topic:
<ul>
	<li>All available cmdlets on Technet - <a href="http://technet.microsoft.com/en-us/library/dd347701.aspx">http://technet.microsoft.com/en-us/library/dd347701.aspx</a></li>
	<li>Some info on background jobs - <a href="http://bartdesmet.net/blogs/bart/archive/2008/03/25/windows-powershell-2-0-feature-focus-background-jobs.aspx">http://bartdesmet.net/blogs/bart/archive/2008/03/25/windows-powershell-2-0-feature-focus-background-jobs.aspx</a></li>
</ul>
